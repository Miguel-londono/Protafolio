---
import maleta from "../assets/img/maleta.png";
import { ClientRouter } from 'astro:transitions';
import "../styles/global.css";
import { ClientRouter } from 'astro:transitions';
//sidebar
import profile from "../../public/Profile.png";
import github from "../assets/svg/Github.svg";
import Linkdin from "../assets/svg/Linkedin.svg";
import X from "../assets/svg/X.svg";
import home from "../assets/svg/Home.svg";
import projects from "../assets/svg/Projects.svg";
import expirience from "../assets/svg/Expirience.svg";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>Protafolio | Miguel Londoño</title>
    <ClientRouter/>
  </head>
  <body class="bg-slate-50 dark:bg-gray-900 dark:text-slate-50">
    <header id="header" class="sticky top-0 z-10 dark:bg-gray-950 sm:ml-64">
      <section class="fade-in max-w-5xl mx-auto">
        <div class="p-4 absolute right-0">
          <button
            id="mobile-open-button"
            class="text-3xl sm:hidden focus:outline-none"
            >&#9776

          </button>
        </div>
        <div
          class="flex flex-col-reverse justify-between p-4 gap-4 sm:flex-row items-center sm:gap-8"
        >
          <div>
            <p>Hey there 👋</p>
            <h1 class="text-xl sm:text-3xl font-bold">
              Hey, Soy Miguel londoño
            </h1>
            <h2 class="text-sm sm:text-base">
              Desarrollador Web full stack en formacion, Especialociado en crear
              aplicaciones y soluciones unicas.
            </h2>
          </div>
          <img
            src={maleta.src}
            alt="maleta"
            class="w-24 h-24 sm:w-36 sm:h-36 p-3"
          />
        </div>
      </section>
    </header>
    <main class="sm:ml-64">
      <slot />
    </main>
    <aside>
      <section
        class="fade-in hidden sm:flex sm:flex-col fixed top-0 left-0 h-screen w-64 dark:bg-gray-950 z-10"
      >
        <div class="flex flex-col flex-grow items-center gap-10 pt-11">
          <h1 class="text-3xl font-bold">Protafolio</h1>
          <a href="/" target="_blank" rel="noopener noreferrer">
            <div class="transition ease-in-out hover:scale-[103%] block m-auto">
              <img
                src={profile.src}
                alt="img-profile"
                class="rounded-full h-32 w-32"
              />
            </div>
          </a>
          <div>
            <ul>
              <li
                id="btnInicio"
                class="flex items-center p-3 gap-3 transition ease-in-out hover:scale-[104%] hover:opacity-80 cursor-pointer hover:bg-slate-600 rounded-lg min-w-44"
              >
                <img src={home.src} alt="gitHub" class="w-6 h-6 dark:invert" />
                Inicio
              </li>

              <li
                id="btnExperience"
                class="flex items-center p-3 gap-3 transition ease-in-out hover:scale-[104%] hover:opacity-80 cursor-pointer hover:bg-slate-600 rounded-lg min-w-44"
              >
                <img
                  src={expirience.src}
                  alt="gitHub"
                  class="w-6 h-6 dark:invert"
                />
                Experiencia
              </li>

              <li
                id="btnTechnologies"
                class="flex items-center p-3 gap-3 transition ease-in-out hover:scale-[104%] hover:opacity-80 cursor-pointer hover:bg-slate-600 rounded-lg min-w-44"
              >
                <img
                  src={expirience.src}
                  alt="gitHub"
                  class="w-6 h-6 dark:invert"
                />
                Tecnologias
              </li>
              <li
                class="flex items-center p-3 gap-3 transition ease-in-out hover:scale-[104%] hover:opacity-80 cursor-pointer hover:bg-slate-600 rounded-lg min-w-44"
              >
                <img
                  src={projects.src}
                  alt="gitHub"
                  class="w-6 h-6 dark:invert"
                />
                Proyectos
              </li>
            </ul>
          </div>
        </div>
        <div class="flex justify-center p-10 gap-6">
          <img
            src={github.src}
            alt="gitHub"
            class="w-8 h-8 dark:invert transition ease-in-out hover:scale-[104%] hover:opacity-70 cursor-pointer"
          />
          <img
            src={Linkdin.src}
            alt="gitHub"
            class="w-8 h-8 dark:invert transition ease-in-out hover:scale-[104%] hover:opacity-70 cursor-pointer"
          />
          <img
            src={X.src}
            alt="gitHub"
            class="w-8 h-8 dark:invert transition ease-in-out hover:scale-[104%] hover:opacity-70 cursor-pointer"
          />
        </div>
      </section>
    </aside>
  </body>
</html>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const observerOptions = { threshold: 0.1 };
    let observer;

    // Función para inicializar IntersectionObserver
    function initObserver() {
      const sections = document.querySelectorAll("section");

      // Desconectar el observer anterior si existe
      if (observer) observer.disconnect();

      observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("show");
          } else {
            entry.target.classList.remove("show");
          }
        });
      }, observerOptions);

      // Observar todas las secciones
      sections.forEach((section) => {
        section.classList.add("fade-in");
        observer.observe(section);
      });
    }

    // Función para hacer scroll ajustando el navbar
    function scrollToSection(section) {
      if (!section) return;

      const navbar = document.querySelector("header");
      const navbarHeight = navbar ? navbar.offsetHeight : 0;
      const offset = section.offsetTop - navbarHeight;

      window.scrollTo({ top: offset, behavior: "smooth" });
    }

    // Manejar la navegación o el scroll
    function navigateOrScroll(targetSectionId, targetPage) {
      const section = document.getElementById(targetSectionId);

      if (section) {
        scrollToSection(section);
      } else {
        // Redirigir y esperar a que cargue la nueva página
        window.location.href = `${targetPage}#${targetSectionId}`;
      }
    }

    // Configurar botones después de renderizar
    function setupButtons() {
      const btnInicio = document.getElementById("btnInicio");
      const btnExperience = document.getElementById("btnExperience");
      const btnTechnologies = document.getElementById("btnTechnologies");

      // Verificar y asignar eventos
      if (btnInicio) {
        btnInicio.addEventListener("click", () =>
          navigateOrScroll("hero", "/")
        );
      }
      if (btnExperience) {
        btnExperience.addEventListener("click", () =>
          navigateOrScroll("experience", "/")
        );
      }
      if (btnTechnologies) {
        btnTechnologies.addEventListener("click", () =>
          navigateOrScroll("technologies", "/")
        );
      }
    }

    // Manejar scroll al cargar la página con hash
    function handleScrollOnLoad() {
      const hash = window.location.hash;
      if (hash) {
        setTimeout(() => {
          const section = document.querySelector(hash);
          if (section) scrollToSection(section);
        }, 100);
      }
    }

    // Inicialización
    initObserver();
    setupButtons();
    handleScrollOnLoad();

    // Reconectar todo después de un swap de Astro
    document.addEventListener("astro:after-swap", () => {
      initObserver();
      setupButtons();
      handleScrollOnLoad();
    });
  });
</script>
